schemaVersion: '2.0'
builds:
- name: base-docker-3.0.17
  branchName: cie-cassandra-3.0.17
  build:
    template: dockerfile:v1:publish
    buildFilePath: rio/
  trigger:
    gitPush: false
  publish:
    docker:
      namespace: pie
      registry: docker.apple.com
      tag: latest
  timeout: 30
- name: ghprb-3.0.17
  branchName: cie-cassandra-3.0.17
  build:
    template: freestyle:v2:prb
    steps:
    - ./rio/test.sh
  machine:
    docker:
      baseImage: docker.apple.com/pie/cie_cassandra:latest
  publish:
    reports:
      junit: true
  timeout: 60
- name: build-3.0.17
  branchName: cie-cassandra-3.0.17
  build:
    template: freestyle:v2:build
    steps:
    - ./rio/test.sh
  machine:
    docker:
      baseImage: docker.apple.com/pie/cie_cassandra:latest
  publish:
    reports:
      junit: true
  timeout: 60
  finally:
    pipelineChain:
        - pipeline: snapshot-3.0.17
- name: snapshot-3.0.17
  branchName: cie-cassandra-3.0.17
  build:
    template: freestyle:v2:snapshot
    steps:
        - ./rio/release.sh 3.0.17-SNAPSHOT
  machine:
    docker:
      baseImage: docker.apple.com/cpbuild/jdk1.8:latest
  publish:
    archives:
      includePattern: ".dist/publishable/**"
    reports:
      junit: false
  finally:
    tag:
      enabled: false
    pipelineChain:
        - pipeline: snapshot-carnival-3.0.17
  trigger:
    gitPush: false
- name: snapshot-carnival-3.0.17
  branchName: cie-cassandra-3.0.17
  build:
    template: freestyle:v2:carnival
    steps:
    - ./rio/carnival.sh 3.0.17
  machine:
    docker:
      baseImage: docker.apple.com/cpbuild/jdk1.8:latest
  publish:
    reports:
      junit: false
    carnival:
      packageName: CIEDb
      packageSuffix: three-zero-seventeen-snapshot
      packagePath: CIEDb/Updates/
    releaseTrain: 1BUILD
  trigger:
    gitPush: false
  finally:
    tag:
      expression: cie-cassandra-3.0.17-$RIO_BUILD_NUMBER.$CODE_VERSION
    radar:
      annotate: true
- name: release-3.0.17
  branchName: cie-cassandra-3.0.17
  build:
    template: freestyle:v2:release
    steps:
    - ./rio/release.sh 3.0.17.1
  machine:
    docker:
      baseImage: docker.apple.com/cpbuild/jdk1.8:latest
  publish:
    archives:
      includePattern: ".dist/publishable/**"
    reports:
      junit: false
  finally:
    tag:
      enabled: false
    pipelineChain:
      - pipeline: carnival-3.0.17
  trigger:
    gitPush: false
- name: carnival-3.0.17
  branchName: cie-cassandra-3.0.17
  build:
    template: freestyle:v2:carnival
    steps:
    - ./rio/carnival.sh 3.0.17.1
  machine:
    docker:
      baseImage: docker.apple.com/cpbuild/jdk1.8:latest
  publish:
    reports:
      junit: false
    carnival:
      packageName: CIEDb
      packageSuffix: three-zero-seventeen-one
      packagePath: CIEDb/Updates/
    releaseTrain: 1BUILD
  finally:
    tag:
      expression: cie-cassandra-3.0.17.1
    radar:
      annotate: true
  trigger:
    gitPush: false
- name: dtest-3.0.17
  branchName: cie-cassandra-3.0.17
  build:
    template: freestyle:v2:build
    steps:
    - /home/tests/run_int.sh --with-xunit --xunit-file=/code/nosetests.xml --test-select-config=conf/cie-cassandra-3.0-all.cfg
  machine:
    docker:
      baseImage: docker.apple.com/pie/cie_cassandra_dtest
  publish:
    logs: logs/
    reports:
      junit:
        path: nosetests.xml
  timeout: 600
  trigger:
    gitPush: true
- name: dtest-3.0.17-fast
  branchName: cie-cassandra-3.0.17
  build:
    template: freestyle:v2:build
    steps:
    - /home/tests/run_int.sh --with-xunit --xunit-file=/code/nosetests.xml --test-select-config=conf/cie-cassandra-3.0-fastest.cfg
  machine:
    env:
      DTEST_TIMEOUT: 300
    docker:
      baseImage: docker.apple.com/pie/cie_cassandra_dtest
  publish:
    logs: logs/
    reports:
      junit:
        path: nosetests.xml
  timeout: 480
  trigger:
    gitPush: true
- name: ghprb-dtest-3.0.17
  disabled: true
  branchName: cie-cassandra-3.0.17
  build:
    template: freestyle:v2:prb
    steps:
    - /home/tests/run_int.sh --with-xunit --xunit-file=/code/nosetests.xml --test-select-config=conf/cie-cassandra-3.0-all.cfg
  machine:
    docker:
      baseImage: docker.apple.com/pie/cie_cassandra_dtest
  publish:
    logs: logs/
    reports:
      junit:
        path: nosetests.xml
  timeout: 600

